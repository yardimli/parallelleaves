<!doctype html>
<html lang="en" class="h-full">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
	<meta http-equiv="Content-Security-Policy"
	      content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' file: data: https:; font-src 'self';">
	<title>Codex Editor</title>
	<link rel="stylesheet" href="../node_modules/bootstrap-icons/font/bootstrap-icons.css">
	<link rel="stylesheet" href="../dist/styles.css">
</head>
<body class="h-full bg-base-100 text-base-content overflow-hidden flex flex-col">

<!-- Top Toolbar -->
<div id="top-toolbar"
     class="flex-shrink-0 h-12 bg-base-100/80 dark:bg-base-300/80 backdrop-blur-sm flex items-center px-4 gap-2 z-50 border-b border-base-300 dark:border-base-100/10">
	<!-- History Section -->
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="undo"
		        data-i18n-title="editor.undo" disabled>
			<i class="bi bi-arrow-counterclockwise text-lg"></i>
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="redo"
		        data-i18n-title="editor.redo" disabled>
			<i class="bi bi-arrow-clockwise text-lg"></i>
		</button>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<!-- Heading Dropdown -->
	<div class="dropdown js-dropdown-container">
		<button type="button" tabindex="0" role="button"
		        class="js-toolbar-btn js-heading-btn btn btn-ghost btn-sm w-28 justify-start" disabled data-i18n="editor.paragraph">Paragraph
		</button>
		<div tabindex="0" class="js-dropdown dropdown-content z-[1] menu p-1 shadow bg-base-100 rounded-box w-40">
			<button class="js-heading-option p-2 rounded w-full text-left text-sm hover:bg-base-200" data-level="0" data-i18n="editor.paragraph">
				Paragraph
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-xl font-bold hover:bg-base-200"
			        data-level="1" data-i18n="editor.heading1">
				Heading 1
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-lg font-bold hover:bg-base-200"
			        data-level="2" data-i18n="editor.heading2">
				Heading 2
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-base font-bold hover:bg-base-200"
			        data-level="3" data-i18n="editor.heading3">Heading 3
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-sm font-bold hover:bg-base-200"
			        data-level="4" data-i18n="editor.heading4">
				Heading 4
			</button>
		</div>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<!-- Formatting Section -->
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square font-bold" data-command="bold"
		        data-i18n-title="editor.bold" disabled>B
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square italic" data-command="italic"
		        data-i18n-title="editor.italic" disabled>I
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square underline"
		        data-command="underline"
		        data-i18n-title="editor.underline" disabled>U
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square line-through"
		        data-command="strike"
		        data-i18n-title="editor.strikethrough" disabled>S
		</button>
		<div class="dropdown js-dropdown-container">
			<button type="button" tabindex="0" role="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square"
			        data-i18n-title="editor.highlight" disabled>
				<i class="bi bi-highlighter text-lg"></i>
			</button>
			<div tabindex="0" class="js-dropdown dropdown-content z-[1] menu p-1 shadow bg-base-100 rounded-box w-32">
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-yellow"><span class="w-4 h-4 rounded-full"
				                                   style="background-color: #fef08a;"></span>
					<span data-i18n="editor.yellow">Yellow</span>
				</button>
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-green"><span class="w-4 h-4 rounded-full"
				                                  style="background-color: #a7f3d0;"></span> <span data-i18n="editor.green">Green</span>
				</button>
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-blue"><span class="w-4 h-4 rounded-full"
				                                 style="background-color: #bfdbfe;"></span> <span data-i18n="editor.blue">Blue</span>
				</button>
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-red"><span class="w-4 h-4 rounded-full"
				                                style="background-color: #fecaca;"></span> <span data-i18n="editor.red">Red</span>
				</button>
				<button class="js-highlight-option p-1 rounded w-full text-left text-xs hover:bg-base-200"
				        data-bg="transparent" data-i18n="editor.none">None
				</button>
			</div>
		</div>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<!-- Block Formatting Section -->
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="bullet_list"
		        data-i18n-title="editor.bulletList" disabled><i class="bi bi-list-ul text-lg"></i></button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="ordered_list"
		        data-i18n-title="editor.orderedList" disabled><i class="bi bi-list-ol text-lg"></i></button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="blockquote"
		        data-i18n-title="editor.blockquote" disabled><i class="bi bi-quote text-lg"></i></button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="horizontal_rule"
		        data-i18n-title="editor.horizontalRule" disabled><i class="bi bi-hr text-lg"></i></button>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn js-ai-action-btn btn btn-ghost btn-sm" data-action="rephrase"
		        data-i18n-title="editor.rephrase" disabled data-i18n="editor.rephrase">Rephrase
		</button>
	</div>
	<div class="flex-grow"></div>
	<button id="js-delete-codex-entry-btn" class="btn btn-ghost btn-sm text-error hidden">
		<i class="bi bi-trash"></i> <span data-i18n="editor.codexEditor.deleteEntry">Delete Entry</span>
	</button>
	<div class="flex items-center text-sm text-base-content/70">
		<span id="js-word-count" data-i18n="editor.noTextSelected">No text selected</span>
	</div>
	<button id="typography-settings-btn" class="btn btn-ghost btn-circle" data-i18n-title="common.typography">
		<i class="bi bi-fonts text-xl"></i>
	</button>
	<button id="theme-toggle" class="btn btn-ghost btn-circle" data-i18n-title="common.changeTheme">
		<i class="bi bi-sun-fill text-xl"></i>
	</button>
</div>

<!-- Main Content Area -->
<div class="flex-grow flex flex-col p-4 overflow-hidden space-y-4">
	<!-- Header -->
	<div class="flex-shrink-0 space-y-1">
		<h2 id="js-novel-info" class="text-sm text-base-content/70" data-i18n="common.loading">Loading...</h2>
	</div>
	
	<!-- Editor Layout -->
	<div class="flex-grow min-h-0">
		<div class="w-full h-full flex flex-col min-w-0 border border-base-300 rounded-md overflow-hidden">
			<form id="js-codex-form" class="flex flex-col h-full" novalidate>
				<div class="flex-shrink-0 p-4 border-b border-base-300 relative">
					<div id="js-ai-suggestion-spinner" class="absolute inset-0 bg-base-100/80 backdrop-blur-sm flex items-center justify-center z-10 hidden">
						<div class="text-center">
							<span class="loading loading-spinner loading-lg"></span>
							<p class="mt-2 text-sm" data-i18n="editor.codexEditor.aiAnalyzing">AI is analyzing text...</p>
						</div>
					</div>
					<input type="text" id="js-codex-title-input"
					       class="text-3xl font-bold w-full bg-transparent border-0 p-0 focus:ring-0 focus:border-b-2 focus:border-teal-500"
					       data-i18n-placeholder="editor.codexEditor.titlePlaceholder" required>
					
					<div class="mt-4">
						<label for="js-codex-phrases-input" class="label pb-1">
							<span class="label-text" data-i18n="editor.codexEditor.phrases">Document Phrases</span>
						</label>
						<input type="text" id="js-codex-phrases-input"
						       class="input input-bordered input-sm w-full"
						       placeholder="e.g., phrase one, another phrase">
						<p class="text-xs text-base-content/60 mt-1" data-i18n="editor.codexEditor.phrasesHelp">Comma-separated phrases to link to this entry from chapter text.</p>
					</div>
					
					<div id="js-create-meta-section" class="hidden mt-4 space-y-2">
						<div class="form-control">
							<label for="js-codex-category" class="label"><span class="label-text" data-i18n="editor.codexEditor.category">Category <span class="text-error">*</span></span></label>
							<select id="js-codex-category" name="codex_category_id" class="select select-bordered select-sm" required>
								<option value="" data-i18n="editor.codexEditor.selectCategory">Select a category...</option>
								<option value="new" data-i18n="editor.codexEditor.newCategory">-- Create New Category --</option>
							</select>
						</div>
						<div id="js-new-category-wrapper" class="hidden pl-4 border-l-4 border-accent">
							<label for="js-new-category-name" class="label"><span class="label-text" data-i18n="editor.codexEditor.newCategoryName">New Category Name</span></label>
							<input type="text" id="js-new-category-name" name="new_category_name" class="input input-bordered input-sm">
						</div>
					</div>
				</div>
				<div class="flex-grow flex min-h-0">
					<div class="w-1/2 flex flex-col border-r border-base-300">
						<label class="p-4 pb-2 text-sm font-semibold uppercase tracking-wider text-base-content/70" data-i18n="editor.codexEditor.sourceContent">Source Content</label>
						<div class="js-pm-container flex-grow p-4 overflow-y-auto prose prose-sm dark:prose-invert max-w-none">
							<div class="js-editable" data-name="content" data-i18n-placeholder="editor.codexEditor.sourcePlaceholder"></div>
						</div>
					</div>
					<div class="w-1/2 flex flex-col">
						<label class="p-4 pb-2 text-sm font-semibold uppercase tracking-wider text-base-content/70" data-i18n="editor.codexEditor.targetContent">Target Content</label>
						<div class="js-pm-container flex-grow p-4 overflow-y-auto prose prose-sm dark:prose-invert max-w-none">
							<div class="js-editable" data-name="target_content" data-i18n-placeholder="editor.codexEditor.targetPlaceholder"></div>
						</div>
					</div>
				</div>
				<div id="js-create-action-section" class="hidden p-4 border-t border-base-300">
					<button type="submit" class="js-create-entry-btn btn btn-primary btn-block">
						<span class="js-btn-text" data-i18n="editor.codexEditor.createButton">Create Entry</span>
						<span class="js-spinner hidden animate-spin"><i class="bi bi-arrow-repeat"></i></span>
					</button>
				</div>
			</form>
		</div>
	</div>
</div>

<!-- Hidden container to hold the initial content for ProseMirror editors -->
<div id="js-pm-content-source" class="hidden">
	<div data-name="content"></div>
	<div data-name="target_content"></div>
</div>

<!-- Prompt Editor Modal (for AI text actions) -->
<dialog id="prompt-editor-modal" class="modal">
	<div class="modal-box w-11/12 max-w-5xl h-[90vh] flex flex-col p-0">
		<div class="flex flex-grow overflow-hidden">
			<main class="w-full flex flex-col overflow-hidden">
				<div class="js-prompt-placeholder flex-grow flex items-center justify-center">
					<p class="text-base-content/60" data-i18n="editor.loadingEditor">Loading editor...</p>
				</div>
				<div class="js-custom-editor-pane hidden flex-grow flex flex-col min-h-0">
					<div class="p-4 border-b border-base-300 flex-shrink-0">
						<h3 class="js-custom-prompt-title text-lg font-bold"></h3>
					</div>
					<div class="js-custom-form-container flex-grow overflow-y-auto min-h-0">
						<div class="p-4 text-center">
							<span class="loading loading-spinner"></span>
						</div>
					</div>
				</div>
			</main>
		</div>
		<div class="modal-action px-6 py-4 border-t border-base-300 flex-shrink-0 flex justify-between items-center">
			<div class="flex items-center gap-4">
				<button type="button" class="js-toggle-preview-btn btn btn-ghost" data-i18n="editor.showPreview">Show Preview</button>
				<select class="js-llm-model-select select select-bordered select-sm w-full max-w-xs">
					<option disabled selected data-i18n="outline.autoGenModal.loadingModels">Loading models...</option>
				</select>
				<button type="button" class="js-prompt-apply-btn btn btn-accent" data-i18n="editor.applyChanges">Apply Changes</button>
			</div>
			<form method="dialog">
				<button class="btn" data-i18n="common.close">Close</button>
			</form>
		</div>
	</div>
</dialog>

<dialog id="alert-modal" class="modal">
	<div class="modal-box w-11/12 max-w-md">
		<h3 id="alert-modal-title" class="font-bold text-lg text-error" data-i18n="common.error">Error</h3>
		<p id="alert-modal-content" class="py-4"></p>
		<div class="modal-action">
			<form method="dialog">
				<button class="btn" data-i18n="common.close">Close</button>
			</form>
		</div>
	</div>
</dialog>

<dialog id="delete-confirm-modal" class="modal">
	<div class="modal-box">
		<h3 class="font-bold text-lg text-error" data-i18n="editor.codexEditor.deleteConfirm.title">Confirm Deletion</h3>
		<p class="py-4" data-i18n="editor.codexEditor.deleteConfirm.message">Are you sure you want to delete this codex entry? This action cannot be undone.</p>
		<div class="modal-action">
			<button id="js-cancel-delete-btn" class="btn" data-i18n="common.cancel">Cancel</button>
			<button id="js-confirm-delete-btn" class="btn btn-error" data-i18n="common.delete">Delete</button>
		</div>
	</div>
</dialog>

<dialog id="typography-settings-modal" class="modal">
	<div class="modal-box">
		<form method="dialog">
			<button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
		</form>
		<h3 class="font-bold text-lg mb-4" data-i18n="common.typography">TYPOGRAPHY</h3>
		<form id="typography-settings-form" class="grid grid-cols-2 gap-x-8 gap-y-6 text-sm w-full">
			<!-- Font family -->
			<div>
				<label for="font-family" class="block font-medium mb-2" data-i18n="common.fontFamily">Font family</label>
				<select name="font_family" class="select select-bordered select-sm w-full">
					<optgroup data-i18n="common.serif" label="Serif">
						<option value="'Noto Serif', serif">Noto Serif</option>
						<option value="'Zilla Slab', serif">Zilla Slab</option>
						<option value="'Roboto Serif', serif">Roboto Serif</option>
						<option value="'Literata', serif">Literata</option>
					</optgroup>
					<optgroup data-i18n="common.sansSerif" label="Sans Serif">
						<option value="'Barlow', sans-serif">Barlow</option>
						<option value="'Exo 2', sans-serif">Exo 2</option>
						<option value="'Atkinson Hyperlegible', sans-serif">Atkinson Hyperlegible</option>
					</optgroup>
					<optgroup data-i18n="common.monospace" label="Monospace">
						<option value="'iA Writer Duospace', monospace">iA Writer Duospace</option>
						<option value="'Recursive', monospace">Recursive</option>
						<option value="'Courier New', Courier, monospace">Courier</option>
						<option value="'Courier Prime', monospace">Courier Prime</option>
					</optgroup>
				</select>
			</div>
			<!-- Text size -->
			<div>
				<label class="block font-medium mb-2" data-i18n="common.textSize">Text size</label>
				<div class="btn-group w-full" data-setting="text_size">
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="sm"><span class="text-xs">Ab</span></button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="base"><span class="text-sm">Ab</span></button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="lg"><span class="text-base">Ab</span></button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="xl"><span class="text-lg font-bold">Ab</span></button>
				</div>
			</div>
			<!-- Line height -->
			<div>
				<label class="block font-medium mb-2" data-i18n="common.lineHeight">Line height</label>
				<div class="btn-group w-full" data-setting="line_height">
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="1">
						<div class="flex flex-col items-center gap-0.5 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="2">
						<div class="flex flex-col items-center gap-1 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="3">
						<div class="flex flex-col items-center gap-1.5 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="4">
						<div class="flex flex-col items-center gap-2 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
				</div>
			</div>
			<!-- Text indent -->
			<div>
				<label class="block font-medium mb-2" data-i18n="common.textIndent">Text indent</label>
				<div class="btn-group w-full" data-setting="text_indent">
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="1">
						<div class="flex flex-col items-start gap-1 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="2">
						<div class="flex flex-col items-start gap-1 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current ml-1"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="3">
						<div class="flex flex-col items-start gap-1 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current ml-2"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="4">
						<div class="flex flex-col items-start gap-1 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current ml-3"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
				</div>
			</div>
			<!-- Paragraph spacing -->
			<div>
				<label class="block font-medium mb-2" data-i18n="common.paragraphSpacing">Paragraph spacing</label>
				<div class="btn-group w-full" data-setting="paragraph_spacing">
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="1">
						<div class="flex flex-col items-center gap-1 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="2">
						<div class="flex flex-col items-center gap-2 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="3">
						<div class="flex flex-col items-center gap-3 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="4">
						<div class="flex flex-col items-center gap-4 py-1">
							<span class="block w-4 h-px bg-current"></span>
							<span class="block w-4 h-px bg-current"></span>
						</div>
					</button>
				</div>
			</div>
			<!-- Page width -->
			<div>
				<label class="block font-medium mb-2" data-i18n="common.pageWidth">Page width</label>
				<div class="btn-group w-full" data-setting="page_width">
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="1">
						<span class="block w-2 h-4 border-y-2 border-current"></span>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="2">
						<span class="block w-3 h-4 border-y-2 border-current"></span>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="3">
						<span class="block w-4 h-4 border-y-2 border-current"></span>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="4">
						<span class="block w-5 h-4 border-y-2 border-current"></span>
					</button>
				</div>
			</div>
			<!-- Text Align -->
			<div class="col-span-1">
				<label class="block font-medium mb-2" data-i18n="common.textAlign">Text Align</label>
				<div class="btn-group w-full" data-setting="text_align">
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="left">
						<i class="bi bi-text-left"></i>
						<span class="ml-1" data-i18n="common.alignLeft">Left</span>
					</button>
					<button type="button" class="btn btn-sm flex-1 min-w-0" data-value="justify">
						<i class="bi bi-justify"></i>
						<span class="ml-1" data-i18n="common.alignJustify">Justify</span>
					</button>
				</div>
			</div>
		</form>
	</div>
</dialog>

<script src="../src/js/theme.js"></script>
<script type="module" src="../dist/codex-editor-bundle.js"></script>
</body>
</html>
