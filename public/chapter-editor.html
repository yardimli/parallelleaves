<!doctype html>
<html lang="en" class="h-full">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
	<meta http-equiv="Content-Security-Policy"
	      content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' file: data: https:; frame-src 'self'; font-src 'self';">
	<title>Parallel Leaves - Chapter Editor</title>
	<link rel="stylesheet" href="../node_modules/bootstrap-icons/font/bootstrap-icons.css">
	<!-- NEW: Added Choices.js stylesheet -->
	<link rel="stylesheet" href="../node_modules/choices.js/public/assets/styles/choices.min.css"/>
	<link rel="stylesheet" href="../dist/styles.css">
</head>
<body class="h-full bg-base-100 text-base-content overflow-hidden flex flex-col">

<!-- Top Toolbar (copied from novel-planner.html for consistent editing experience) -->
<div id="top-toolbar"
     class="flex-shrink-0 h-12 bg-base-100/80 dark:bg-base-300/80 backdrop-blur-sm flex items-center px-4 gap-2 z-50 border-b border-base-300 dark:border-base-100/10">
	<!-- History Section -->
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="undo"
		        data-i18n-title="editor.undo" disabled>
			<i class="bi bi-arrow-counterclockwise text-lg"></i>
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="redo"
		        data-i18n-title="editor.redo" disabled>
			<i class="bi bi-arrow-clockwise text-lg"></i>
		</button>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<!-- Heading Dropdown -->
	<div class="dropdown js-dropdown-container">
		<button type="button" tabindex="0" role="button"
		        class="js-toolbar-btn js-heading-btn btn btn-ghost btn-sm w-28 justify-start" disabled data-i18n="editor.paragraph">Paragraph
		</button>
		<div tabindex="0" class="js-dropdown dropdown-content z-[1] menu p-1 shadow bg-base-100 rounded-box w-40">
			<button class="js-heading-option p-2 rounded w-full text-left text-sm hover:bg-base-200" data-level="0" data-i18n="editor.paragraph">
				Paragraph
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-xl font-bold hover:bg-base-200"
			        data-level="1" data-i18n="editor.heading1">
				Heading 1
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-lg font-bold hover:bg-base-200"
			        data-level="2" data-i18n="editor.heading2">
				Heading 2
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-base font-bold hover:bg-base-200"
			        data-level="3" data-i18n="editor.heading3">Heading 3
			</button>
			<button class="js-heading-option p-2 rounded w-full text-left text-sm font-bold hover:bg-base-200"
			        data-level="4" data-i18n="editor.heading4">
				Heading 4
			</button>
		</div>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<!-- Formatting Section -->
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square font-bold" data-command="bold"
		        data-i18n-title="editor.bold" disabled>B
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square italic" data-command="italic"
		        data-i18n-title="editor.italic" disabled>I
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square underline"
		        data-command="underline"
		        data-i18n-title="editor.underline" disabled>U
		</button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square line-through"
		        data-command="strike"
		        data-i18n-title="editor.strikethrough" disabled>S
		</button>
		<div class="dropdown js-dropdown-container">
			<button type="button" tabindex="0" role="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square"
			        data-i18n-title="editor.highlight" disabled>
				<i class="bi bi-highlighter text-lg"></i>
			</button>
			<div tabindex="0" class="js-dropdown dropdown-content z-[1] menu p-1 shadow bg-base-100 rounded-box w-32">
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-yellow"><span class="w-4 h-4 rounded-full"
				                                   style="background-color: #fef08a;"></span>
					<span data-i18n="editor.yellow">Yellow</span>
				</button>
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-green"><span class="w-4 h-4 rounded-full"
				                                  style="background-color: #a7f3d0;"></span> <span data-i18n="editor.green">Green</span>
				</button>
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-blue"><span class="w-4 h-4 rounded-full"
				                                 style="background-color: #bfdbfe;"></span> <span data-i18n="editor.blue">Blue</span>
				</button>
				<button
					class="js-highlight-option p-1 rounded w-full text-left flex items-center gap-2 text-xs hover:bg-base-200"
					data-bg="highlight-red"><span class="w-4 h-4 rounded-full"
				                                style="background-color: #fecaca;"></span> <span data-i18n="editor.red">Red</span>
				</button>
				<button class="js-highlight-option p-1 rounded w-full text-left text-xs hover:bg-base-200"
				        data-bg="transparent" data-i18n="editor.none">None
				</button>
			</div>
		</div>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<!-- Block Formatting Section -->
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="bullet_list"
		        data-i18n-title="editor.bulletList" disabled><i class="bi bi-list-ul text-lg"></i></button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="ordered_list"
		        data-i18n-title="editor.orderedList" disabled><i class="bi bi-list-ol text-lg"></i></button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="blockquote"
		        data-i18n-title="editor.blockquote" disabled><i class="bi bi-quote text-lg"></i></button>
		<button type="button" class="js-toolbar-btn btn btn-ghost btn-sm btn-square" data-command="horizontal_rule"
		        data-i18n-title="editor.horizontalRule" disabled><i class="bi bi-hr text-lg"></i></button>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<div class="flex items-center gap-1">
		<button type="button" class="js-toolbar-btn js-ai-action-btn btn btn-ghost btn-sm" data-action="rephrase"
		        data-i18n-title="editor.rephrase" disabled data-i18n="editor.rephrase">Rephrase
		</button>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<div class="flex items-center gap-1">
		<button type="button" id="js-open-chat-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.openChat">
			<i class="bi bi-chat-dots text-lg"></i>
		</button>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<div class="flex items-center gap-1">
		<button type="button" id="js-search-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.search">
			<i class="bi bi-search text-lg"></i>
		</button>
		<button type="button" id="js-search-replace-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.searchReplace.title">
			<i class="bi bi-search-heart text-lg"></i>
		</button>
	</div>
	<div class="divider divider-horizontal mx-0"></div>
	<div class="flex items-center gap-1">
		<button type="button" id="js-open-dictionary-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="prompt.common.dictionary">
			<i class="bi bi-book text-lg"></i>
		</button>
		<button type="button" id="js-open-codex-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.openCodex">
			<i class="bi bi-journal-richtext text-lg"></i>
		</button>
		<button type="button" id="js-translation-memory-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.translationMemory.updateTitle">
			<i class="bi bi-lightbulb text-lg"></i>
		</button>
	</div>
	<div class="flex-grow"></div>
	<button id="typography-settings-btn" class="btn btn-ghost btn-circle" data-i18n-title="common.typography">
		<i class="bi bi-fonts text-xl"></i>
	</button>
	<div class="dropdown dropdown-end">
		<button tabindex="0" role="button" class="btn btn-ghost btn-circle" data-i18n-title="common.changeLanguage">
			<i class="bi bi-translate text-xl"></i>
		</button>
		<ul tabindex="0" id="js-lang-switcher-menu" class="dropdown-content z-[1] menu p-2 shadow bg-base-200 rounded-box w-32">
			<!-- Populated by i18n.js -->
		</ul>
	</div>
	<!-- Refresh Page Button -->
	<button id="js-refresh-page-btn" class="btn btn-ghost btn-circle" data-i18n-title="common.refresh">
		<i class="bi bi-arrow-clockwise text-xl"></i>
	</button>
	<button id="theme-toggle" class="btn btn-ghost btn-circle mr-2" data-i18n-title="common.changeTheme">
		<i class="bi bi-sun-fill text-xl"></i>
	</button>
</div>

<!-- Search Bar -->
<div id="js-search-bar" class="hidden flex-shrink-0 h-12 bg-base-200 flex items-center px-4 gap-4 z-40 border-b border-base-300">
	<input type="text" id="js-search-input" class="input input-sm input-bordered w-full max-w-xs" data-i18n-placeholder="editor.searchBar.placeholder">
	<div class="form-control">
		<label class="label cursor-pointer gap-2 p-0">
			<span class="label-text text-sm" data-i18n="editor.searchBar.source">Source</span>
			<input type="radio" name="search-scope" class="radio radio-sm" value="source" checked />
		</label>
	</div>
	<div class="form-control">
		<label class="label cursor-pointer gap-2 p-0">
			<span class="label-text text-sm" data-i18n="editor.searchBar.target">Target</span>
			<input type="radio" name="search-scope" class="radio radio-sm" value="target" />
		</label>
	</div>
	<div class="flex items-center gap-1">
		<button id="js-search-prev-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.searchBar.previous" disabled>
			<i class="bi bi-chevron-up"></i>
		</button>
		<button id="js-search-next-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.searchBar.next" disabled>
			<i class="bi bi-chevron-down"></i>
		</button>
	</div>
	<span id="js-search-results-count" class="text-sm text-base-content/70 w-24 text-center"></span>
	<div class="flex-grow"></div>
	<button id="js-search-close-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.searchBar.close">
		<i class="bi bi-x-lg"></i>
	</button>
</div>

<!-- Search and Replace Bar -->
<div id="js-search-replace-bar" class="hidden flex-shrink-0 h-auto bg-base-200 flex flex-col p-2 gap-1 z-40 border-b border-base-300">
	<!-- Find Row -->
	<div class="flex items-center gap-2">
		<!-- Input container with 50% width -->
		<div class="relative w-1/2">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-base-content/50 pointer-events-none">
                <i class="bi bi-search"></i>
            </span>
			<input type="text" id="js-search-replace-input" class="input input-sm input-bordered w-full pl-10 pr-12" data-i18n-placeholder="editor.searchReplace.findPlaceholder">
			<button id="js-case-sensitive-btn" class="absolute inset-y-0 right-0 flex items-center px-2 btn btn-ghost btn-sm font-mono" data-i18n-title="editor.searchReplace.caseSensitive">
				Aa
			</button>
		</div>
		<!-- Buttons and info aligned left -->
		<span id="js-search-replace-results-count" class="text-sm text-base-content/70 w-20 text-center"></span>
		<div class="flex items-center gap-1">
			<button id="js-search-replace-prev-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.searchReplace.previous" disabled>
				<i class="bi bi-chevron-up"></i>
			</button>
			<button id="js-search-replace-next-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.searchReplace.next" disabled>
				<i class="bi bi-chevron-down"></i>
			</button>
		</div>
		<!-- Spacer to push close button to the right -->
		<div class="flex-grow"></div>
		<button id="js-search-replace-close-btn" class="btn btn-ghost btn-sm btn-square" data-i18n-title="editor.searchReplace.close">
			<i class="bi bi-x-lg"></i>
		</button>
	</div>
	<!-- Replace Row -->
	<div class="flex items-center gap-2">
		<!-- Input container with 50% width -->
		<div class="relative w-1/2">
             <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-base-content/50 pointer-events-none">
                <i class="bi bi-arrow-left-right"></i>
            </span>
			<input type="text" id="js-replace-input" class="input input-sm input-bordered w-full pl-10" data-i18n-placeholder="editor.searchReplace.replacePlaceholder">
		</div>
		<!-- Buttons aligned left -->
		<div class="flex items-center gap-1">
			<button id="js-replace-btn" class="btn btn-sm btn-outline" data-i18n="editor.searchReplace.replace" disabled>Replace</button>
			<button id="js-replace-all-btn" class="btn btn-sm btn-outline" data-i18n="editor.searchReplace.replaceAll" disabled>Replace All</button>
		</div>
	</div>
</div>


<!-- Main Content Area -->
<div class="flex-grow flex flex-col overflow-hidden">
	<div class="flex-shrink-0 flex items-center gap-4 px-4 py-2 border-b border-base-300">
		<h2 id="js-novel-title" class="text-xl font-bold" data-i18n="common.loading">Loading...</h2>
		<select id="js-chapter-nav-dropdown" class="select select-bordered select-sm w-full max-w-xs">
			<option data-i18n="editor.loadingNav">Loading navigation...</option>
		</select>
		<div class="flex-grow"></div>
		<div class="flex items-center gap-2">
			<label for="js-spellcheck-lang-dropdown" class="text-sm font-medium" data-i18n="editor.spellcheck">Spellcheck:</label>
			<select id="js-spellcheck-lang-dropdown" class="select select-bordered select-sm">
				<option data-i18n="common.loading">Loading...</option>
			</select>
		</div>
	</div>
	
	<div class="flex-grow flex min-h-0 relative">
		<div id="ai-action-spinner-overlay" class="hidden absolute inset-0 bg-base-100/80 backdrop-blur-sm flex items-center justify-center z-50">
			<div class="text-center">
				<span class="loading loading-spinner loading-lg"></span>
				<p class="mt-2 text-sm" data-i18n="editor.waitingAi">Waiting for AI response...</p>
			</div>
		</div>
		<div id="js-source-column-container" class="w-1/2 overflow-y-auto border-r border-base-300">
			<!-- Source content will be rendered here by JS -->
		</div>
		<div id="js-target-column-container" class="w-1/2 overflow-y-auto">
			<!-- Target iframes will be rendered here by JS -->
		</div>
	</div>
</div>

<div id="bottom-status-bar" class="flex-shrink-0 h-8 bg-base-100 flex items-center px-4 gap-4 z-40 border-t border-base-300 dark:border-base-100/10 text-sm">
	<!-- MODIFICATION: Added a span for translation memory status updates -->
	<span id="js-tm-status" class="text-base-content/70"></span>
	<div class="flex-grow"></div>
	<div class="flex items-center text-base-content/70">
		<span id="js-total-word-count" class="mr-4"></span>
		<span id="js-word-count" data-i18n="editor.noTextSelected">No text selected</span>
	</div>
</div>

<div id="modal-placeholders"></div>

<script src="../src/js/theme.js"></script>
<!-- NEW: Added Choices.js script -->
<script src="../node_modules/choices.js/public/assets/scripts/choices.min.js"></script>
<script type="module" src="../dist/chapter-editor-bundle.js"></script>
</body>
</html>
